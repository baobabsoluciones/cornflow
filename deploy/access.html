<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Access control - Cornflow 1.1.0 documentation</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Logging and monitoring" href="logs.html" /><link rel="prev" title="Production deployment and security" href="production.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=36d120a7" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Access control"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>Cornflow</strong>
    </a>
    <div class="sy-head-nav" id="HeadNav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="HeadNav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../main/index.html">Main topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../main/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../main/concepts.html">Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../main/architecture.html">Cornflow-server architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../main/install.html">Installation instructions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">User guides and how-to</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/deploy_solver_new.html">Deploy a new solution method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/coding_style.html">Solution method coding style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/jsonschema.html">Write a json-schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing_app.html">Test your solution method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/use_solver.html">Use your solution method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/debug_with_airflow.html">Debug your solution method</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples of solution methods</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/bar_cutting.html">Bar cutting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/facility_location.html">Facility location</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/graph_coloring.html">Graph coloring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/knapsack.html">Knapsack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/rostering.html">Rostering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/scheduling.html">Scheduling: hackathon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/tsp.html">Travelling Salesman Problem (TSP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/two_dimensional_bin_packing.html">two_dimensional_bin_packing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/vrp.html">Vehicle Routing Problem (VRP)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../clients/index.html">Supported clients</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../clients/python-api.html">Python API</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Deploy your own cornflow-server</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Before you begin</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker-compose.yml.html">docker-compose.yml</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker-stack.html">Docker stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="simultaneous.html">Running with simultaneous resolutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html">Deployment options</a></li>
<li class="toctree-l2"><a class="reference internal" href="production.html">Production deployment and security</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Access control</a></li>
<li class="toctree-l2"><a class="reference internal" href="logs.html">Logging and monitoring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Code documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/auxiliar_models.html">Auxiliar models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/meta_models.html">Meta models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/endpoints.html">Main endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/other_endpoints.html">Other endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/auxiliar_endpoints.html">Auxiliar endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/cornflow_client.html">Cornflow-client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stable-rest-api-ref.html">API reference</a></li>
</ul>

        </div>
      </div></div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#user-access-data">User access data</a><ul>
<li><a class="reference internal" href="#with-auth-db-default">With Auth-DB (default)</a></li>
<li><a class="reference internal" href="#with-auth-ldap">With Auth-LDAP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#roles-definition">Roles definition</a><ul>
<li><a class="reference internal" href="#roles-with-auth-ldap">Roles with Auth-LDAP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cornflow-interactions-with-airflow-service-user">Cornflow interactions with airflow (service user)</a><ul>
<li><a class="reference internal" href="#cornflow-airflow">Cornflow &#8658; Airflow</a></li>
<li><a class="reference internal" href="#airflow-cornflow">Airflow &#8658; Cornflow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manage-cornflow-users">Manage cornflow users</a></li>
<li><a class="reference internal" href="#manage-airflow-users">Manage airflow users</a></li>
<li><a class="reference internal" href="#external-ldap-authentication-server-requirements">External LDAP authentication server requirements</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6"><div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Cornflow</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Deploy your own cornflow-server</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Access control</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="access-control">
<h1>Access control<a class="headerlink" href="#access-control" title="Permalink to this heading">¶</a></h1>
<p>Cornflow supports multi-user access using password encryption authentication. The user needs to authenticate at least once with the cornflow server to obtain a token that allows him to continue operating.
In this section we will explain the workflow and data process when create users, delete them or change the user´s access password.</p>
<section id="user-access-data">
<h2>User access data<a class="headerlink" href="#user-access-data" title="Permalink to this heading">¶</a></h2>
<p>Right now cornflow has two valid user authentication methods. The first is AUTH_DB, which in addition to being the one that is activated by default, is the easiest to configure since the authentication is carried out against the application itself that stores the credentials in encrypted form.
The second method is AUTH_LDAP. This method allows you to link cornflow with your own security directory and thus the application will delegate the authentication of the users.</p>
<section id="with-auth-db-default">
<h3>With Auth-DB (default)<a class="headerlink" href="#with-auth-db-default" title="Permalink to this heading">¶</a></h3>
<p>Cornflow has an environment variable to control the type of authentication we want to activate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">AUTH_TYPE</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">(</span><span class="n">Auth</span><span class="o">-</span><span class="n">DB</span> <span class="n">default</span> <span class="n">method</span><span class="p">)</span>
</span></pre></div>
</div>
<p>User datatable default content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">user</span> <span class="n">name</span>
</span><span data-line="2"><span class="n">password</span>
</span><span data-line="3"><span class="n">first</span> <span class="n">name</span>
</span><span data-line="4"><span class="n">last</span> <span class="n">name</span>
</span><span data-line="5"><span class="n">email</span>
</span><span data-line="6"><span class="n">admin</span><span class="o">-</span><span class="nb">super</span> <span class="n">admin</span> <span class="p">(</span><span class="n">deprecated</span><span class="p">)</span>
</span><span data-line="7"><span class="n">auditory</span> <span class="n">fields</span> <span class="p">(</span><span class="n">cornflow</span> <span class="n">saves</span> <span class="n">information</span> <span class="n">such</span> <span class="n">us</span> <span class="n">the</span> <span class="n">date</span> <span class="n">of</span> <span class="n">creation</span> <span class="ow">or</span> <span class="n">modification</span> <span class="n">of</span> <span class="n">the</span> <span class="n">user</span><span class="p">)</span>
</span></pre></div>
</div>
<p>The password is stored encrypted in the database. If a user does not have a password an email will be sent with the temporary access password.</p>
</section>
<section id="with-auth-ldap">
<h3>With Auth-LDAP<a class="headerlink" href="#with-auth-ldap" title="Permalink to this heading">¶</a></h3>
<p>As we saw previously cornflow has an environment variable to control the type of authentication we want to activate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">AUTH_TYPE</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">(</span><span class="n">Auth</span><span class="o">-</span><span class="n">LDAP</span> <span class="n">authentication</span><span class="p">)</span>
</span></pre></div>
</div>
<p>This authentication will be through a unique user code “common name” (user name) and password. The password will never be stored on the cornflow server but other data will be stored that will allow users to migrate or import to change the type of authentication. This operation cannot be performed with the server running.
In the event that you consult the connection through LDAP, the following information will be requested from the server.,</p>
<p>User datatable default content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">user</span> <span class="n">name</span>
</span><span data-line="2"><span class="n">email</span>
</span><span data-line="3"><span class="n">auditory</span> <span class="n">fields</span> <span class="o">-</span> <span class="p">(</span><span class="n">cornflow</span> <span class="n">saves</span> <span class="n">information</span> <span class="n">such</span> <span class="n">us</span> <span class="n">the</span> <span class="n">date</span> <span class="n">of</span> <span class="n">creation</span> <span class="ow">or</span> <span class="n">modification</span> <span class="n">of</span> <span class="n">the</span> <span class="n">user</span><span class="p">)</span>
</span></pre></div>
</div>
<p>User data objects request from LDAP server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">password</span> <span class="n">validation</span> <span class="p">(</span><span class="n">only</span> <span class="k">for</span> <span class="n">compare</span><span class="p">)</span>
</span><span data-line="2"><span class="n">email</span>
</span><span data-line="3"><span class="n">role</span>
</span></pre></div>
</div>
<p>No password is stored in the database. No confirmation email is sent with a temporary access password.</p>
<p><strong>LDAP authentication library</strong></p>
<p>In cornflow we have used <a class="reference external" href="https://github.com/tedivm/tedivms-flask">this library</a> to develop authentication methods. With this configuration the cornflow backend will be connected to external LDAP server:</p>
<p>Any installation can run with Auth-LDAP as its backend with these settings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">LDAP_HOST</span> <span class="o">-</span> <span class="n">ldap</span> <span class="n">server</span> <span class="n">address</span>
</span><span data-line="2"><span class="n">LDAP_BIND_DN</span> <span class="o">-</span> <span class="n">ldap</span> <span class="n">admin</span> <span class="n">search</span> <span class="k">for</span> <span class="n">domain</span>
</span><span data-line="3"><span class="n">LDAP_BIND_PASSWORD</span> <span class="o">-</span> <span class="n">ldap</span> <span class="n">admin</span> <span class="n">search</span> <span class="n">password</span>
</span><span data-line="4"><span class="n">LDAP_USERNAME_ATTRIBUTE</span> <span class="o">-</span> <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">attribute</span> <span class="n">that</span> <span class="n">represents</span> <span class="n">the</span> <span class="n">unique</span> <span class="n">ID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">user</span>
</span><span data-line="5"><span class="n">LDAP_USER_BASE</span> <span class="o">-</span> <span class="n">The</span> <span class="n">base</span> <span class="n">DN</span> <span class="n">subtree</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">when</span> <span class="n">searching</span> <span class="k">for</span> <span class="n">user</span> <span class="n">entries</span> <span class="n">on</span> <span class="n">the</span> <span class="n">LDAP</span> <span class="n">server</span>
</span><span data-line="6"><span class="n">LDAP_USER_OBJECT_CLASS</span> <span class="o">-</span> <span class="n">The</span> <span class="nb">object</span> <span class="n">classes</span> <span class="n">are</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">LDAP</span> <span class="n">directory</span> <span class="n">schema</span> <span class="p">(</span><span class="n">they</span> <span class="n">constitute</span> <span class="n">a</span> <span class="k">class</span> <span class="nc">hierarchy</span> <span class="n">there</span><span class="p">)</span>
</span><span data-line="7"><span class="n">LDAP_GROUP_OBJECT_CLASS</span> <span class="o">-</span> <span class="n">Filter</span> <span class="n">used</span> <span class="k">for</span> <span class="n">returning</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">group</span> <span class="n">member</span> <span class="n">entries</span> <span class="n">that</span> <span class="n">are</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">LDAP</span> <span class="n">base</span> <span class="n">DN</span> <span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="n">subtree</span>
</span><span data-line="8"><span class="n">LDAP_GROUP_ATTRIBUTE</span> <span class="o">-</span> <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">group</span> <span class="n">search</span> <span class="nb">filter</span> <span class="n">that</span> <span class="n">represents</span> <span class="n">the</span> <span class="n">group</span> <span class="n">name</span>
</span><span data-line="9"><span class="n">LDAP_GROUP_BASE</span> <span class="o">-</span> <span class="n">The</span> <span class="n">base</span> <span class="n">DN</span> <span class="n">subtree</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">when</span> <span class="n">searching</span> <span class="k">for</span> <span class="n">group</span> <span class="n">entries</span> <span class="n">on</span> <span class="n">the</span> <span class="n">LDAP</span> <span class="n">server</span>
</span><span data-line="10"><span class="n">LDAP_USE_TLS</span> <span class="o">-</span> <span class="n">TLS</span> <span class="n">communication</span> <span class="n">protocol</span> <span class="p">(</span><span class="n">Transport</span> <span class="n">Layer</span> <span class="n">Security</span><span class="p">)</span> <span class="n">over</span> <span class="mi">636</span> <span class="n">port</span>
</span><span data-line="11"><span class="n">LDAP_EMAIL_ATTRIBUTE</span> <span class="o">-</span> <span class="n">ldap</span> <span class="n">email</span> <span class="n">user</span> <span class="nb">object</span>
</span></pre></div>
</div>
</section>
</section>
<section id="roles-definition">
<h2>Roles definition<a class="headerlink" href="#roles-definition" title="Permalink to this heading">¶</a></h2>
<p>In cornflow there is a differentiation between three user roles with different characteristics:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Admin</span> <span class="o">-</span> <span class="n">admin</span> <span class="n">user</span> <span class="n">can</span> <span class="n">manage</span> <span class="n">the</span> <span class="n">rest</span> <span class="n">of</span> <span class="n">cornflow</span> <span class="n">users</span> <span class="ow">and</span> <span class="n">also</span> <span class="n">has</span> <span class="n">access</span> <span class="n">to</span> <span class="n">make</span> <span class="n">changes</span> <span class="n">to</span> <span class="n">the</span> <span class="n">airflow</span> <span class="n">platform</span>
</span><span data-line="2"><span class="n">Service</span> <span class="o">-</span> <span class="n">service</span> <span class="n">user</span> <span class="n">role</span> <span class="k">for</span> <span class="n">cornflow</span> <span class="ow">and</span> <span class="n">airflow</span> <span class="n">communication</span>
</span><span data-line="3"><span class="n">Viewer</span> <span class="o">-</span> <span class="n">read</span> <span class="n">only</span> <span class="n">user</span>
</span><span data-line="4"><span class="n">Planner</span> <span class="o">-</span> <span class="n">the</span> <span class="n">general</span> <span class="n">user</span> <span class="n">of</span> <span class="n">cornflow</span> <span class="n">can</span> <span class="n">create</span> <span class="n">jobs</span> <span class="ow">and</span> <span class="n">send</span> <span class="n">models</span> <span class="n">to</span> <span class="n">solve</span>
</span></pre></div>
</div>
<p>Each role is stored in a table linking the role code with the permissions on the application.
In addition, there is a temporary link between the user and his role that will not be updated until the login operation is performed again.</p>
<p><strong>User role assignation (in all authentication types)</strong></p>
<p>In this table we have the role assignment for each user. May be more than one role assigned to the user.</p>
<p>Data storage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">User</span> <span class="n">ID</span> <span class="o">-</span> <span class="n">internal</span> <span class="n">cornflow</span> <span class="n">user</span> <span class="n">identification</span>
</span><span data-line="2"><span class="n">Role</span> <span class="n">ID</span> <span class="n">assigned</span> <span class="o">-</span> <span class="n">role</span> <span class="n">identification</span> <span class="n">assigned</span> <span class="n">to</span> <span class="n">the</span> <span class="n">user</span>
</span></pre></div>
</div>
<p><strong>Role data storage (in all authentication types)</strong></p>
<p>Master data of roles in application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Role</span> <span class="n">ID</span> <span class="o">-</span> <span class="n">internal</span> <span class="n">cornflow</span> <span class="n">role</span> <span class="n">identification</span>
</span><span data-line="2"><span class="n">Role</span> <span class="n">name</span> <span class="o">-</span> <span class="n">role</span> <span class="n">name</span>
</span></pre></div>
</div>
<section id="roles-with-auth-ldap">
<h3>Roles with Auth-LDAP<a class="headerlink" href="#roles-with-auth-ldap" title="Permalink to this heading">¶</a></h3>
<p>In the cornflow server deployment, the LDAP server roles will be configured through environment variables. Cornflow roles to bind to ldap server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">LDAP_GROUP_TO_ROLE_SERVICE</span>
</span><span data-line="2"><span class="n">LDAP_GROUP_TO_ROLE_ADMIN</span>
</span><span data-line="3"><span class="n">LDAP_GROUP_TO_ROLE_VIEWER</span>
</span><span data-line="4"><span class="n">LDAP_GROUP_TO_ROLE_PLANNER</span>
</span></pre></div>
</div>
<p>In this way, the user permissions and their defined roles are always done within the cornflow application and allow the authentication configuration to be changed in the future.</p>
</section>
</section>
<section id="cornflow-interactions-with-airflow-service-user">
<h2>Cornflow interactions with airflow (service user)<a class="headerlink" href="#cornflow-interactions-with-airflow-service-user" title="Permalink to this heading">¶</a></h2>
<section id="cornflow-airflow">
<h3>Cornflow ⇒ Airflow<a class="headerlink" href="#cornflow-airflow" title="Permalink to this heading">¶</a></h3>
<p>Not all cornflow users can access airflow. A role defined in the application will give access to perform actions that involve communication with airflow through the user defined in the previous point.
If the user has access to airflow, in each communication, the username and password that provides access to the platform will be provided by this environment variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">AIRFLOW_USER</span> <span class="o">-</span> <span class="n">airflow</span> <span class="n">user</span> <span class="n">name</span> <span class="k">for</span> <span class="n">login</span> <span class="ow">in</span> <span class="n">airflow</span> <span class="ow">and</span> <span class="n">manage</span> <span class="n">dags</span>
</span><span data-line="2"><span class="n">AIRFLOW_PWD</span> <span class="o">-</span> <span class="n">airflow</span> <span class="n">user</span> <span class="n">password</span>
</span></pre></div>
</div>
<p>Airflow does not have to be connected via LDAP. Linking them does not affect how cornflow works. Airflow receives a username and password that has privileges to perform actions defined in the system by cornflow.
The cornflow user profile in airflow must have the following permissions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">administrate</span> <span class="n">connections</span>
</span><span data-line="2"><span class="n">administrate</span> <span class="n">DAG</span>
</span><span data-line="3"><span class="n">administrative</span> <span class="n">Tasks</span>
</span><span data-line="4"><span class="n">administrate</span> <span class="n">DAG</span> <span class="n">Runs</span>
</span><span data-line="5"><span class="n">administrator</span> <span class="n">Jobs</span>
</span></pre></div>
</div>
<p>If airflow also connects through LDAP to the same active directory, it will be necessary in the deployment configuration to bind the user that communicates cornflow with the role that gives the previously defined permissions.
The user who operates airflow through cornflow may not be the same user who has the role of system administrator of the platform.</p>
<p><strong>User access to dags</strong></p>
<p>The user access to each dag in airflow can be controlled in cornflow. Cornflow store a table with dags and have roles that give access to each dag individually.</p>
</section>
<section id="airflow-cornflow">
<h3>Airflow ⇒ Cornflow<a class="headerlink" href="#airflow-cornflow" title="Permalink to this heading">¶</a></h3>
<p>Airflow use a cornflow service rights that allow it to do some operations. It´s used to get and post to any user’s instances and executions. In this way this role restrict for doing admin stuff (e.g., manage users or delete them)
Service user is a good solution for doing all the data interaction between applications. You have only to pay attention to one account for set permissions and key values on deployment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">CORNFLOW_SERVICE_USER - service user account name for communications between cornflow and airflow (default value `service_user`)
</span><span data-line="2">CORNFLOW_SERVICE_MAIL - service user account email (default value `service_user@cornflow.com`)
</span><span data-line="3">CORNFLOW_SERVICE_PWD - service user account password (default value `Service_user1234`)
</span></pre></div>
</div>
<p>This connection is provided by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">AIRFLOW_CONN_CF_URI</span><span class="o">=</span><span class="s2">&quot;cornflow://CORNFLOW_SERVICE_USER:CORNFLOW_SERVICE_PWD@cornflowserveraddress:cornflowserverport&quot;</span>
</span></pre></div>
</div>
<p>Keep in mind to change default credentials when going to production.</p>
</section>
</section>
<section id="manage-cornflow-users">
<h2>Manage cornflow users<a class="headerlink" href="#manage-cornflow-users" title="Permalink to this heading">¶</a></h2>
<p>In the cornflow image, if no environment variables are set, an admin user is created with these credentials:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">CORNFLOW_ADMIN_USER</span> <span class="o">-</span> <span class="n">cornflow_admin</span>
</span><span data-line="2"><span class="n">CORNFLOW_ADMIN_EMAIL</span> <span class="o">-</span> <span class="n">cornflow_admin</span><span class="nd">@cornflow</span><span class="o">.</span><span class="n">com</span>
</span><span data-line="3"><span class="n">CORNFLOW_ADMIN_PWD</span> <span class="o">-</span> <span class="n">Cornflow_admin1234</span>
</span></pre></div>
</div>
<p>It is advisable to change the default admin user and keep the password in a safe place.</p>
<p>To create a user, you must interact with the cornflow application through an <a class="reference external" href="https://baobabsoluciones.github.io/cornflow/dev/endpoints.html#module-cornflow.endpoints.user">endpoint of its API</a>. Check the API docs for the users <a class="reference external" href="https://baobabsoluciones.github.io/corn/stable-rest-api-ref.html#tag/Users">here</a>. It is only possible to create new cornflow admin user using another one with those privileges.</p>
</section>
<section id="manage-airflow-users">
<h2>Manage airflow users<a class="headerlink" href="#manage-airflow-users" title="Permalink to this heading">¶</a></h2>
<p>The default administrator user for airflow and flower will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">AIRFLOW_USER</span> <span class="o">-</span> <span class="n">admin</span>
</span><span data-line="2"><span class="n">AIRFLOW_PWD</span> <span class="o">-</span> <span class="n">admin</span>
</span></pre></div>
</div>
<p>It is advisable to change the default admin user and keep the password in a safe place.
<a class="reference external" href="https://airflow.apache.org/docs/apache-airflow/stable/security/access-control.html">Access Control of Airflow Webserver UI</a> is handled by Flask AppBuilder (FAB). Please read its related security document regarding its <a class="reference external" href="http://flask-appbuilder.readthedocs.io/en/latest/security.html">security model</a>.</p>
<p>Remember to configure all authentication, users and access before passing to production. Check the previous section for more information: <a class="reference internal" href="production.html#production-deployment-and-security"><span class="std std-ref">Production deployment and security</span></a>.</p>
</section>
<section id="external-ldap-authentication-server-requirements">
<h2>External LDAP authentication server requirements<a class="headerlink" href="#external-ldap-authentication-server-requirements" title="Permalink to this heading">¶</a></h2>
<p>The requirements to communicate cornflow with an LDAP server are the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">An</span> <span class="n">authentication</span> <span class="n">server</span> <span class="k">with</span> <span class="n">support</span> <span class="k">for</span> <span class="n">the</span> <span class="n">LDAPv3</span> <span class="n">protocol</span><span class="o">.</span>
</span><span data-line="2"><span class="n">The</span> <span class="n">LDAP</span> <span class="n">server</span> <span class="n">must</span> <span class="n">be</span> <span class="n">visible</span> <span class="n">at</span> <span class="nb">all</span> <span class="n">times</span> <span class="n">on</span> <span class="n">the</span> <span class="n">network</span> <span class="n">by</span> <span class="n">the</span> <span class="n">cornflow</span> <span class="n">server</span><span class="o">.</span>
</span><span data-line="3"><span class="n">The</span> <span class="n">users</span> <span class="n">created</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">LDAP</span> <span class="n">server</span> <span class="n">must</span> <span class="n">have</span> <span class="n">unique</span> <span class="n">identifiers</span> <span class="ow">and</span> <span class="n">roles</span> <span class="n">defined</span> <span class="n">to</span> <span class="n">relate</span> <span class="n">them</span> <span class="n">to</span> <span class="n">the</span> <span class="n">existing</span> <span class="n">ones</span> <span class="ow">in</span> <span class="n">cornflow</span><span class="o">.</span>
</span><span data-line="4"><span class="n">All</span> <span class="n">users</span> <span class="n">must</span> <span class="n">have</span> <span class="n">a</span> <span class="n">unique</span> <span class="n">user</span> <span class="n">identifier</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">password</span> <span class="n">protocol</span> <span class="n">will</span> <span class="n">be</span> <span class="n">the</span> <span class="n">one</span> <span class="n">provided</span> <span class="n">by</span> <span class="n">the</span> <span class="n">LDAP</span> <span class="n">authentication</span> <span class="n">system</span><span class="o">.</span>
</span><span data-line="5"><span class="n">Users</span> <span class="n">must</span> <span class="n">have</span> <span class="n">a</span> <span class="n">field</span> <span class="n">to</span> <span class="n">store</span> <span class="n">the</span> <span class="n">email</span><span class="o">.</span>
</span><span data-line="6"><span class="n">The</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">LDAP</span> <span class="nb">object</span> <span class="n">used</span> <span class="n">to</span> <span class="n">search</span> <span class="k">for</span> <span class="n">users</span> <span class="p">(</span><span class="n">objectClass</span><span class="p">)</span>
</span></pre></div>
</div>
<p>For example, here are some example values for each of the ldap_user_type object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">(</span><span class="n">objectClass</span><span class="o">=</span><span class="n">posixAccount</span><span class="p">)</span> <span class="k">for</span> <span class="n">RFC</span><span class="o">-</span><span class="mi">2037</span> <span class="ow">and</span> <span class="n">RFC</span><span class="o">-</span><span class="mi">2037</span><span class="n">bis</span>
</span><span data-line="2"><span class="p">(</span><span class="n">objectClass</span><span class="o">=</span><span class="n">sambaSamAccount</span><span class="p">)</span> <span class="k">for</span> <span class="n">SAMBA</span> <span class="mf">3.0</span><span class="o">.</span><span class="n">x</span> <span class="n">LDAP</span> <span class="n">extension</span>
</span><span data-line="3"><span class="p">(</span><span class="n">objectClass</span><span class="o">=</span><span class="n">user</span><span class="p">)</span> <span class="k">for</span> <span class="n">MS</span><span class="o">-</span><span class="n">AD</span>
</span><span data-line="4"><span class="p">(</span><span class="n">objectClass</span><span class="o">=*</span><span class="p">)</span> <span class="k">for</span> <span class="n">Default</span>
</span></pre></div>
</div>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="production.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Production deployment and security</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="logs.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Logging and monitoring</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2020-, cornflow documentation team.</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=def9ab29"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/design-tabs.js?v=36754332"></script>
      <script src="../_static/shibuya.js?v=c5fc9e80"></script></body>
</html>