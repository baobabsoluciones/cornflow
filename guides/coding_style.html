
  <!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Coding style and rules - Cornflow 1.0.10 documentation</title>
    <link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Write a json-schema" href="jsonschema.html" /><link rel="prev" title="How to deploy a new solution method (2.0)" href="deploy_solver_new.html" />

  <script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(sessionStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=aecf457f" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=aef655f6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Coding style and rules"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="document"><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="../index.html">
      
      
      <strong>Cornflow</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav"></nav>
      <div class="sy-head-extra flex items-center print:hidden">
        
<form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
        <div class="sy-head-socials flex items-center">
</div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center"
        data-aria-auto="Switch to light color mode"
        data-aria-light="Switch to dark color mode"
        data-aria-dark="Switch to auto color mode">
        <i class="i-lucid theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../main/index.html">Main topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../main/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../main/concepts.html">Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../main/architecture.html">Cornflow-server architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../main/install.html">Installation instructions</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User guides and how-to</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="deploy_solver_new.html">Deploy a new solution method</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Solution method coding style</a></li>
<li class="toctree-l2"><a class="reference internal" href="jsonschema.html">Write a json-schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing_app.html">Test your solution method</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_solver.html">Use your solution method</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_with_airflow.html">Debug your solution method</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples of solution methods</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/bar_cutting.html">Bar cutting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/facility_location.html">Facility location</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/graph_coloring.html">Graph coloring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/knapsack.html">Knapsack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/rostering.html">Rostering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/scheduling.html">Scheduling: hackathon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/tsp.html">Travelling Salesman Problem (TSP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/two_dimensional_bin_packing.html">two_dimensional_bin_packing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/vrp.html">Vehicle Routing Problem (VRP)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../clients/index.html">Supported clients</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../clients/python-api.html">Python API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/index.html">Deploy your own cornflow-server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../deploy/intro.html">Before you begin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/docker-compose.yml.html">docker-compose.yml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/docker-stack.html">Docker stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/simultaneous.html">Running with simultaneous resolutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/options.html">Deployment options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/production.html">Production deployment and security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/access.html">Access control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/logs.html">Logging and monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/problems.html">Known problems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Code documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/auxiliar_models.html">Auxiliar models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/meta_models.html">Meta models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/endpoints.html">Main endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/other_endpoints.html">Other endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/auxiliar_endpoints.html">Auxiliar endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/cornflow_client.html">Cornflow-client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stable-rest-api-ref.html">API reference</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucid close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4">
  <div class="localtoc">
    <h3>On this page</h3>
    <ul>
<li><a class="reference internal" href="#commenting-out-code">Commenting out code</a></li>
<li><a class="reference internal" href="#argument-type-checking">Argument type checking</a></li>
<li><a class="reference internal" href="#indentation">Indentation</a></li>
<li><a class="reference internal" href="#no-repetition">No repetition</a></li>
<li><a class="reference internal" href="#filtering-lists-or-dictionaries">Filtering lists or dictionaries</a></li>
<li><a class="reference internal" href="#working-with-superdicts">Working with SuperDicts</a><ul>
<li><a class="reference internal" href="#accessing-properties">Accessing properties</a></li>
</ul>
</li>
</ul>

  </div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucid menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList">
      
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Cornflow</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li>
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">User guides and how-to</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li>
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Coding style and rules</strong>
        <meta itemprop="position" content="3" />
      </li>
      
      
    </ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucid outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="coding-style-and-rules">
<h1>Coding style and rules<a class="headerlink" href="#coding-style-and-rules" title="Permalink to this heading">¶</a></h1>
<p>The following rules and notation come from examples in PR-revisions that we think can become common rules. Each rule will have an example and a description.</p>
<section id="commenting-out-code">
<h2>Commenting out code<a class="headerlink" href="#commenting-out-code" title="Permalink to this heading">¶</a></h2>
<p>Having commented code makes no sense. It should be eliminated from the commit altogether. If for some reason you fear losing the piece of code in the future, remember that it will be present in the git history if it has taken part of the <strong>master branch</strong> at some point:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cm">/* LMapPoints () {</span>
</span><span data-line="2"><span class="cm">  var points = []</span>
</span><span data-line="3"><span class="cm">  var offsetCustomers = 1 + this.instance.data.sources.length</span>
</span><span data-line="4"><span class="cm">  for (var point of this.instance.lonLat) {</span>
</span><span data-line="5"><span class="cm">    var newPoint = { x: point.x, y: point.y, location: point.location }</span>
</span><span data-line="6"><span class="cm">    if (point.location === 0) {</span>
</span><span data-line="7"><span class="cm">      newPoint.type = &#39;B&#39;</span>
</span><span data-line="8"><span class="cm">    } else if (point.location &lt; 1 + this.instance.data.sources.length) {</span>
</span><span data-line="9"><span class="cm">      newPoint.type = &#39;S&#39;</span>
</span><span data-line="10"><span class="cm">    } else {</span>
</span><span data-line="11"><span class="cm">      newPoint.type = &#39;C&#39;</span>
</span><span data-line="12"><span class="cm">      newPoint.capacity = this.instance.data.customers[point.location - offsetCustomers].Capacity</span>
</span><span data-line="13"><span class="cm">    }</span>
</span><span data-line="14"><span class="cm">    points.push(newPoint)</span>
</span><span data-line="15"><span class="cm">  }</span>
</span><span data-line="16"><span class="cm">  return points</span>
</span><span data-line="17"><span class="cm">} */</span>
</span></pre></div>
</div>
</section>
<section id="argument-type-checking">
<h2>Argument type checking<a class="headerlink" href="#argument-type-checking" title="Permalink to this heading">¶</a></h2>
<p>Both python and javascript can be very lax with type validations in arguments and interfaces. This is usually very practical but it can sometimes lead to the following (incorrect) “runtime validations” inside a function:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experiment</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ExperimentCore</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">MyInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Instance</span>
</span><span data-line="3"><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">MySolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Solution</span>
</span><span data-line="4">
</span><span data-line="5"><span class="w">  </span><span class="kr">constructor</span><span class="w"> </span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="nx">solution</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="nx">solution</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">solution</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">solution</span><span class="p">.</span><span class="nx">colors</span>
</span><span data-line="10"><span class="w">    </span><span class="p">}</span>
</span><span data-line="11">
</span><span data-line="12"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizeCustomerPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span>
</span><span data-line="13"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizeBasePoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">30</span>
</span><span data-line="14"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizeSourcePoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>
</span><span data-line="15"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="16"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">offsetCustomers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
</span><span data-line="17"><span class="w">    </span><span class="p">}</span>
</span><span data-line="18"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">colorBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;#65A0D1&#39;</span>
</span><span data-line="19"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">colorSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;#D35A5A&#39;</span>
</span><span data-line="20">
</span><span data-line="21"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="22"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">horizon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">horizon</span>
</span><span data-line="23"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">unit</span>
</span><span data-line="24"><span class="w">    </span><span class="p">}</span>
</span><span data-line="25"><span class="w">  </span><span class="p">}</span>
</span></pre></div>
</div>
<p>In the example, we’re checking for the existence of instance and solution when creating a new Experiment.</p>
<p>In fact, these validations should not be done inside. Experiment is correct to assume that when it requires an instance and a solution, it should get one as arguments. If the arguments were optional, then they should appear with a default value in the method. In practice, we <em>want</em> Experiment to fail when there are incorrect (unexpected) arguments.</p>
<p>The actual validations should be done outside (before) the creation of the Experiment so as to be sure to provide Experiment always with an instance and a solution.</p>
<p>These kinds of validations can be done in javascript (python) with the use of TypeScript (python type-hints). While TypeScript is not yet present in Cornflow-app, python type-hints are very well present in cornflow-server and cornflow-client.</p>
<p>In this case, the correct code would be the same but without ifs:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experiment</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ExperimentCore</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">MyInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Instance</span>
</span><span data-line="3"><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">MySolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Solution</span>
</span><span data-line="4">
</span><span data-line="5"><span class="w">  </span><span class="kr">constructor</span><span class="w"> </span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="nx">solution</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="nx">solution</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">solution</span><span class="p">.</span><span class="nx">colors</span>
</span><span data-line="9">
</span><span data-line="10"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizeCustomerPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span>
</span><span data-line="11"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizeBasePoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">30</span>
</span><span data-line="12"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizeSourcePoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>
</span><span data-line="13"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">offsetCustomers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
</span><span data-line="14"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">colorBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;#65A0D1&#39;</span>
</span><span data-line="15"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">colorSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;#D35A5A&#39;</span>
</span><span data-line="16">
</span><span data-line="17"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">horizon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">horizon</span>
</span><span data-line="18"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">unit</span>
</span><span data-line="19"><span class="w">  </span><span class="p">}</span>
</span></pre></div>
</div>
</section>
<section id="indentation">
<h2>Indentation<a class="headerlink" href="#indentation" title="Permalink to this heading">¶</a></h2>
<p>original code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">driver</span> <span class="o">=</span> <span class="n">shift</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span>
</span><span data-line="2"><span class="n">time_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_driver_property</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;TimeCost&quot;</span><span class="p">)</span>
</span><span data-line="3"><span class="n">layover_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_driver_property</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;LayoverCost&quot;</span><span class="p">)</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">trailer</span> <span class="o">=</span> <span class="n">shift</span><span class="p">[</span><span class="s2">&quot;trailer&quot;</span><span class="p">]</span>
</span><span data-line="6"><span class="n">dist_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_trailer_property</span><span class="p">(</span><span class="n">trailer</span><span class="p">,</span> <span class="s2">&quot;DistanceCost&quot;</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="n">current_stop</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="9"><span class="n">layover</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="10">
</span><span data-line="11">
</span><span data-line="12"><span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">shift</span><span class="p">[</span><span class="s2">&quot;route&quot;</span><span class="p">]:</span>
</span><span data-line="13">    <span class="n">previous_stop</span> <span class="o">=</span> <span class="n">current_stop</span>
</span><span data-line="14">    <span class="n">current_stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>
</span><span data-line="15">    <span class="k">if</span> <span class="n">stop</span><span class="p">[</span><span class="s2">&quot;layover_before&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="16">        <span class="n">layover</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="17">    <span class="k">if</span> <span class="n">previous_stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="18">        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_distance_between</span><span class="p">(</span>
</span><span data-line="19">            <span class="n">previous_stop</span><span class="p">,</span> <span class="n">current_stop</span>
</span><span data-line="20">        <span class="p">)</span>
</span><span data-line="21">        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_time_between</span><span class="p">(</span><span class="n">previous_stop</span><span class="p">,</span> <span class="n">current_stop</span><span class="p">)</span>
</span><span data-line="22">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_source</span><span class="p">(</span><span class="n">current_stop</span><span class="p">):</span>
</span><span data-line="23">            <span class="n">time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_source_property</span><span class="p">(</span>
</span><span data-line="24">                <span class="n">current_stop</span><span class="p">,</span> <span class="s2">&quot;setupTime&quot;</span>
</span><span data-line="25">            <span class="p">)</span>
</span><span data-line="26">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_customer</span><span class="p">(</span><span class="n">current_stop</span><span class="p">):</span>
</span><span data-line="27">            <span class="n">time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_customer_property</span><span class="p">(</span>
</span><span data-line="28">                <span class="n">current_stop</span><span class="p">,</span> <span class="s2">&quot;setupTime&quot;</span>
</span><span data-line="29">            <span class="p">)</span>
</span><span data-line="30">        <span class="n">total_cost</span> <span class="o">+=</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">dist_cost</span> <span class="o">+</span> <span class="n">time</span> <span class="o">*</span> <span class="n">time_cost</span>
</span><span data-line="31">
</span><span data-line="32">
</span><span data-line="33"><span class="k">if</span> <span class="n">layover</span><span class="p">:</span>
</span><span data-line="34">    <span class="n">total_cost</span> <span class="o">+=</span> <span class="n">layover_cost</span>
</span></pre></div>
</div>
<p>In general, excessive indentation makes the code hard to review and understand. One way to do that with an if inside a for is with something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">if</span> <span class="n">previous_stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">continue</span> <span class="c1"># the loop ends here</span>
</span><span data-line="3"><span class="c1"># continue with the for-loop as it were an else clause.</span>
</span><span data-line="4"><span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_distance_between</span><span class="p">(</span><span class="n">previous_stop</span><span class="p">,</span> <span class="n">current_stop</span><span class="p">)</span>
</span></pre></div>
</div>
<p>On top of that, if you have all this indentation and long for loops you can just create a function called <cite>_get_route_cost(stop)</cite> and use it inside the function. Something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">def</span> <span class="nf">_get_route_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">time_cost</span><span class="p">,</span> <span class="n">layover_cost</span><span class="p">,</span> <span class="n">dist_cost</span><span class="p">):</span>
</span><span data-line="2">
</span><span data-line="3">    <span class="n">current_stop</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="4">    <span class="n">layover</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="5">    <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">route</span><span class="p">:</span>
</span><span data-line="8">        <span class="n">previous_stop</span> <span class="o">=</span> <span class="n">current_stop</span>
</span><span data-line="9">        <span class="n">current_stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>
</span><span data-line="10">        <span class="k">if</span> <span class="n">stop</span><span class="p">[</span><span class="s2">&quot;layover_before&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="11">            <span class="n">layover</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="12">        <span class="k">if</span> <span class="n">previous_stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="13">            <span class="k">continue</span>
</span><span data-line="14">        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_distance_between</span><span class="p">(</span>
</span><span data-line="15">            <span class="n">previous_stop</span><span class="p">,</span> <span class="n">current_stop</span>
</span><span data-line="16">        <span class="p">)</span>
</span><span data-line="17">        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_time_between</span><span class="p">(</span><span class="n">previous_stop</span><span class="p">,</span> <span class="n">current_stop</span><span class="p">)</span>
</span><span data-line="18">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_source</span><span class="p">(</span><span class="n">current_stop</span><span class="p">):</span>
</span><span data-line="19">            <span class="n">time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_source_property</span><span class="p">(</span>
</span><span data-line="20">                <span class="n">current_stop</span><span class="p">,</span> <span class="s2">&quot;setupTime&quot;</span>
</span><span data-line="21">            <span class="p">)</span>
</span><span data-line="22">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_customer</span><span class="p">(</span><span class="n">current_stop</span><span class="p">):</span>
</span><span data-line="23">            <span class="n">time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_customer_property</span><span class="p">(</span>
</span><span data-line="24">                <span class="n">current_stop</span><span class="p">,</span> <span class="s2">&quot;setupTime&quot;</span>
</span><span data-line="25">            <span class="p">)</span>
</span><span data-line="26">        <span class="n">cost</span> <span class="o">+=</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">dist_cost</span> <span class="o">+</span> <span class="n">time</span> <span class="o">*</span> <span class="n">time_cost</span>
</span><span data-line="27">
</span><span data-line="28">    <span class="k">if</span> <span class="n">layover</span><span class="p">:</span>
</span><span data-line="29">        <span class="n">cost</span> <span class="o">+=</span> <span class="n">layover_cost</span>
</span><span data-line="30">    <span class="k">return</span> <span class="n">cost</span>
</span><span data-line="31">
</span><span data-line="32"><span class="k">def</span> <span class="nf">_get_shift_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">):</span>
</span><span data-line="33">    <span class="n">total_cost</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="34">    <span class="n">driver</span> <span class="o">=</span> <span class="n">shift</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span>
</span><span data-line="35">    <span class="n">time_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_driver_property</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;TimeCost&quot;</span><span class="p">)</span>
</span><span data-line="36">    <span class="n">layover_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_driver_property</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;LayoverCost&quot;</span><span class="p">)</span>
</span><span data-line="37">
</span><span data-line="38">    <span class="n">trailer</span> <span class="o">=</span> <span class="n">shift</span><span class="p">[</span><span class="s2">&quot;trailer&quot;</span><span class="p">]</span>
</span><span data-line="39">    <span class="n">dist_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">get_trailer_property</span><span class="p">(</span><span class="n">trailer</span><span class="p">,</span> <span class="s2">&quot;DistanceCost&quot;</span><span class="p">)</span>
</span><span data-line="40">    <span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">shift</span><span class="p">[</span><span class="s2">&quot;route&quot;</span><span class="p">]:</span>
</span><span data-line="41">        <span class="n">total_cost</span> <span class="o">+=</span> <span class="n">_get_route_cost</span><span class="p">(</span><span class="n">shift</span><span class="p">[</span><span class="s1">&#39;route&#39;</span><span class="p">],</span> <span class="n">time_cost</span><span class="p">,</span> <span class="n">layover_cost</span><span class="p">,</span> <span class="n">dist_cost</span><span class="p">)</span>
</span><span data-line="42">    <span class="k">return</span> <span class="n">total_cost</span>
</span><span data-line="43">
</span><span data-line="44"><span class="k">def</span> <span class="nf">get_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="45">    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_shift_cost</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span> <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></pre></div>
</div>
<p>Of course, this can be greatly improved with more tweaks.</p>
</section>
<section id="no-repetition">
<h2>No repetition<a class="headerlink" href="#no-repetition" title="Permalink to this heading">¶</a></h2>
<p>original code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;customers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;customers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span data-line="2"><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;trailers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;trailers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span data-line="3"><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;drivers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;drivers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span data-line="4"><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></pre></div>
</div>
<p>better:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;customers&quot;</span><span class="p">,</span><span class="s2">&quot;trailers&quot;</span><span class="p">,</span><span class="s2">&quot;drivers&quot;</span><span class="p">,</span><span class="s2">&quot;sources&quot;</span><span class="p">]:</span>
</span><span data-line="2">    <span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
<section id="filtering-lists-or-dictionaries">
<h2>Filtering lists or dictionaries<a class="headerlink" href="#filtering-lists-or-dictionaries" title="Permalink to this heading">¶</a></h2>
<p>Filtering lists with list comprehensions is the easiest way to filter one. With <cite>pytups</cite>, you make it a little shorter.</p>
<p>For example, instead of:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">used_routes</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span data-line="2">    <span class="k">if</span> <span class="ow">not</span> <span class="n">keep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span data-line="3">        <span class="k">del</span> <span class="n">used_routes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
</span></pre></div>
</div>
<p>if <cite>used_routes</cite> is a TupList:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">used_routes</span> <span class="o">=</span> <span class="n">used_routes</span><span class="o">.</span><span class="n">vfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">keep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</span></pre></div>
</div>
</section>
<section id="working-with-superdicts">
<h2>Working with SuperDicts<a class="headerlink" href="#working-with-superdicts" title="Permalink to this heading">¶</a></h2>
<section id="accessing-properties">
<h3>Accessing properties<a class="headerlink" href="#accessing-properties" title="Permalink to this heading">¶</a></h3>
<p>If we have our data in <cite>SuperDicts</cite> there is a set of operations that can be done in a much simplier way.</p>
<p>For example, instead of:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">def</span> <span class="nf">get_real_end_timeslot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SuperDict</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">return</span> <span class="n">SuperDict</span><span class="p">(</span>
</span><span data-line="3">        <span class="p">{</span>
</span><span data-line="4">            <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span> <span class="n">get_date_time_from_string</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;end_timeslot&quot;</span><span class="p">])</span>
</span><span data-line="5">            <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">),</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;production_scheduling&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span data-line="6">        <span class="p">}</span>
</span><span data-line="7">    <span class="p">)</span>
</span></pre></div>
</div>
<p>Where we are taking one of the keys of a nested dictionary can be done:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">def</span> <span class="nf">get_real_end_timeslot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SuperDict</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">return</span> <span class="p">(</span>
</span><span data-line="3">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;production_scheduling&quot;</span><span class="p">]</span>
</span><span data-line="4">        <span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;end_timeslot&quot;</span><span class="p">)</span>
</span><span data-line="5">        <span class="o">.</span><span class="n">vapply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">get_date_time_from_string</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span data-line="6">    <span class="p">)</span>
</span></pre></div>
</div>
<p>And if we set up a method to access the properties as we have in some <cite>Instances</cite> (<cite>_get_property</cite>), we can have:</p>
</section>
</section>
</section>

        </article>
        <button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button>
        
        <div class="navigation flex print:hidden">
  <div class="navigation-prev">
    <a href="deploy_solver_new.html">
      <i class="i-lucid chevron"></i>
      <div class="page-info">
        <span>Previous</span>
        
        <div class="title">How to deploy a new solution method (2.0)</div>
        
      </div>
    </a>
  </div>
  <div class="navigation-next">
    <a href="jsonschema.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Write a json-schema</div>
      </div>
      <i class="i-lucid chevron"></i>
    </a>
  </div>
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2020-, cornflow documentation team.</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
</div>
    </div>
  </div>
</footer></div>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=4f5bc5c4"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/design-tabs.js?v=36754332"></script>
      <script src="../_static/shibuya.js?v=9aab5f5b"></script>
    
</body>
</html>