

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Cornflow &mdash; Cornflow 0.4 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Concepts" href="concepts.html" />
    <link rel="prev" title="Main topics" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Cornflow
          

          
          </a>

          
            
            
              <div class="version">
                0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Main topics</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Install</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation-instructions">Installation instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-cornflow">Install cornflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-cornflow-database">Setup cornflow database</a></li>
<li class="toctree-l4"><a class="reference internal" href="#launch-cornflow-server">Launch cornflow server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-and-configure-airflow">Install and configure airflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#launch-airflow-server">Launch airflow server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#killing-airflow">Killing airflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-cornflow-with-the-python-client">Using cornflow with the python client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tests-and-coverage">Running tests and coverage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-with-docker">Install with docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pull">Pull</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build">Build</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#help-me">Help me</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clients/index.html">Supported clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides and how-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stable-rest-api-ref.html">API reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cornflow</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Main topics</a> &raquo;</li>
        
      <li>Cornflow</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/main/includeme.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cornflow">
<h1><a class="toc-backref" href="#id1">Cornflow</a><a class="headerlink" href="#cornflow" title="Permalink to this headline">¶</a></h1>
<a class="reference external image-reference" href="https://github.com/baobabsoluciones/corn/actions"><img alt="https://github.com/baobabsoluciones/corn/workflows/build/badge.svg?style=svg" src="https://github.com/baobabsoluciones/corn/workflows/build/badge.svg?style=svg" /></a>
<a class="reference external image-reference" href="https://github.com/baobabsoluciones/corn/actions"><img alt="https://github.com/baobabsoluciones/corn/workflows/docs/badge.svg?style=svg" src="https://github.com/baobabsoluciones/corn/workflows/docs/badge.svg?style=svg" /></a>
<a class="reference external image-reference" href="https://github.com/baobabsoluciones/corn/actions"><img alt="https://github.com/baobabsoluciones/corn/workflows/integration/badge.svg?style=svg" src="https://github.com/baobabsoluciones/corn/workflows/integration/badge.svg?style=svg" /></a>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/cornflow-client"><img alt="https://img.shields.io/pypi/v/cornflow-client.svg?style=svg" src="https://img.shields.io/pypi/v/cornflow-client.svg?style=svg" /></a>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/cornflow-client"><img alt="https://img.shields.io/pypi/pyversions/cornflow-client.svg?style=svg" src="https://img.shields.io/pypi/pyversions/cornflow-client.svg?style=svg" /></a>
<img alt="https://img.shields.io/badge/License-MIT-blue.svg?style=svg" src="https://img.shields.io/badge/License-MIT-blue.svg?style=svg" /><p>Cornflow is open source multi-solver optimization server with a REST API built using <a class="reference external" href="https://flask.palletsprojects.com">flask</a>, <a class="reference external" href="https://airflow.apache.org/">airflow</a> and <a class="reference external" href="https://coin-or.github.io/pulp/">pulp</a>.</p>
<p>It supports generic MIP models via the pulp interface and thus connects to CPLEX, GUROBI, CBC, MOSEK, GLPK, XPRESS, MIPCL and others. In the future it will support a generic CP interface that will connect it to: ORTOOLS, CHOCO and CPO. Finally, it supports specific application “solvers” written in python (natively) or in any other language as long as they can be used from airflow.</p>
<p>The aim of this project is to simplify the deployment of optimization-based applications by handling the following tasks:</p>
<ul class="simple">
<li><p>storage of users, instances, solutions and logs.</p></li>
<li><p>deployment and maintenance of models, solvers and algorithms.</p></li>
<li><p>scheduling of executions in remote machines.</p></li>
<li><p>centralizing of commercial licenses.</p></li>
</ul>
<div class="contents topic" id="table-of-contents">
<p class="topic-title"><strong>Table of Contents</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#cornflow" id="id1">Cornflow</a></p>
<ul>
<li><p><a class="reference internal" href="#installation-instructions" id="id2">Installation instructions</a></p>
<ul>
<li><p><a class="reference internal" href="#requirements" id="id3">Requirements</a></p></li>
<li><p><a class="reference internal" href="#install-cornflow" id="id4">Install cornflow</a></p></li>
<li><p><a class="reference internal" href="#setup-cornflow-database" id="id5">Setup cornflow database</a></p></li>
<li><p><a class="reference internal" href="#launch-cornflow-server" id="id6">Launch cornflow server</a></p></li>
<li><p><a class="reference internal" href="#install-and-configure-airflow" id="id7">Install and configure airflow</a></p></li>
<li><p><a class="reference internal" href="#launch-airflow-server" id="id8">Launch airflow server</a></p></li>
<li><p><a class="reference internal" href="#killing-airflow" id="id9">Killing airflow</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-cornflow-with-the-python-client" id="id10">Using cornflow with the python client</a></p></li>
<li><p><a class="reference internal" href="#running-tests-and-coverage" id="id11">Running tests and coverage</a></p></li>
<li><p><a class="reference internal" href="#install-with-docker" id="id12">Install with docker</a></p>
<ul>
<li><p><a class="reference internal" href="#pull" id="id13">Pull</a></p></li>
<li><p><a class="reference internal" href="#build" id="id14">Build</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id15">Usage</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#help-me" id="id16">Help me</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="installation-instructions">
<h2><a class="toc-backref" href="#id2">Installation instructions</a><a class="headerlink" href="#installation-instructions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="requirements">
<h3><a class="toc-backref" href="#id3">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Linux or Windows with WSL</p></li>
<li><p>python &gt;= 3.5</p></li>
<li><p>postgresql</p></li>
</ul>
</div>
<div class="section" id="install-cornflow">
<h3><a class="toc-backref" href="#id4">Install cornflow</a><a class="headerlink" href="#install-cornflow" title="Permalink to this headline">¶</a></h3>
<p>Cornflow consists of two projects: cornflow (itself) and airflow (from apache). They are conceived to be deployed independently. Here we will explain the “development deploy” that consists on installing them in the same machine.</p>
<p>Download the Cornflow project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">baobabsoluciones</span><span class="o">/</span><span class="n">corn</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">corn</span>
<span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">cfvenv</span>
<span class="n">cfvenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">pip3</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">-</span><span class="n">dev</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>activate the virtual environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">cfvenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>or, in windows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cfvenv</span><span class="o">/</span><span class="n">Scripts</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-cornflow-database">
<h3><a class="toc-backref" href="#id5">Setup cornflow database</a><a class="headerlink" href="#setup-cornflow-database" title="Permalink to this headline">¶</a></h3>
<p>This local example assumes sqlite as database engine. For an example of postgresql deployment, see the next section.</p>
<p>Initialize the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">cfvenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=</span><span class="n">cornflow</span><span class="o">.</span><span class="n">app</span>
<span class="n">export</span> <span class="n">DATABASE_URL</span><span class="o">=</span><span class="n">sqlite</span><span class="p">:</span><span class="o">///</span><span class="n">cornflow</span><span class="o">.</span><span class="n">db</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">db</span> <span class="n">upgrade</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">access_init</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">create_service_user</span>  <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="n">airflow</span> <span class="o">--</span><span class="n">email</span><span class="o">=</span><span class="n">airflow_test</span><span class="nd">@admin</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="n">airflow_test_password</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">create_admin_user</span>  <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="n">cornflow</span> <span class="o">--</span><span class="n">email</span><span class="o">=</span><span class="n">cornflow_admin</span><span class="nd">@admin</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="n">cornflow_admin_password</span>
</pre></div>
</div>
</div>
<div class="section" id="launch-cornflow-server">
<h3><a class="toc-backref" href="#id6">Launch cornflow server</a><a class="headerlink" href="#launch-cornflow-server" title="Permalink to this headline">¶</a></h3>
<p>Each time you run the flask server, execute the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">cfvenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=</span><span class="n">cornflow</span><span class="o">.</span><span class="n">app</span>
<span class="n">export</span> <span class="n">FLASK_ENV</span><span class="o">=</span><span class="n">development</span>
<span class="n">export</span> <span class="n">DATABASE_URL</span><span class="o">=</span><span class="n">sqlite</span><span class="p">:</span><span class="o">///</span><span class="n">cornflow</span><span class="o">.</span><span class="n">db</span>
<span class="n">export</span> <span class="n">SECRET_KEY</span><span class="o">=</span><span class="n">THISNEEDSTOBECHANGED</span>
<span class="n">export</span> <span class="n">AIRFLOW_URL</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span>
<span class="n">export</span> <span class="n">AIRFLOW_USER</span><span class="o">=</span><span class="n">admin</span>
<span class="n">export</span> <span class="n">AIRFLOW_PWD</span><span class="o">=</span><span class="n">admin</span>
<span class="n">flask</span> <span class="n">run</span>
</pre></div>
</div>
<p>In windows use <code class="docutils literal notranslate"><span class="pre">set</span></code> instead of <code class="docutils literal notranslate"><span class="pre">export</span></code>.</p>
</div>
<div class="section" id="install-and-configure-airflow">
<h3><a class="toc-backref" href="#id7">Install and configure airflow</a><a class="headerlink" href="#install-and-configure-airflow" title="Permalink to this headline">¶</a></h3>
<p>Here are the minimal instructions to install and configure airflow with the default dags in this project. The instructions assume Ubuntu.</p>
<p>Create a virtual environment for airflow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">corn</span>
<span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">afvenv</span>
<span class="n">source</span> <span class="n">afvenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>Install airflow from pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AIRFLOW_VERSION</span><span class="o">=</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">0</span>
<span class="n">PYTHON_VERSION</span><span class="o">=</span><span class="s2">&quot;$(python3 --version | cut -d &quot;</span> <span class="s2">&quot; -f 2 | cut -d &quot;</span><span class="o">.</span><span class="s2">&quot; -f 1-2)&quot;</span>
<span class="n">CONSTRAINT_URL</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/apache/airflow/constraints-$</span><span class="si">{AIRFLOW_VERSION}</span><span class="s2">/constraints-$</span><span class="si">{PYTHON_VERSION}</span><span class="s2">.txt&quot;</span>
<span class="n">pip</span> <span class="n">install</span> <span class="s2">&quot;apache-airflow==$</span><span class="si">{AIRFLOW_VERSION}</span><span class="s2">&quot;</span> <span class="o">--</span><span class="n">constraint</span> <span class="s2">&quot;$</span><span class="si">{CONSTRAINT_URL}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Install the default workers dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">orloge</span> <span class="n">cornflow_client</span> <span class="n">pulp</span>
</pre></div>
</div>
<p>Initialize the database and create an admin user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">AIRFLOW_HOME</span><span class="o">=</span><span class="s2">&quot;$PWD/airflow_config&quot;</span>
<span class="n">airflow</span> <span class="n">db</span> <span class="n">init</span>
<span class="n">airflow</span> <span class="n">users</span> <span class="n">create</span> \
      <span class="o">--</span><span class="n">username</span> <span class="n">admin</span> \
      <span class="o">--</span><span class="n">firstname</span> <span class="n">admin</span> \
      <span class="o">--</span><span class="n">lastname</span> <span class="n">admin</span> \
      <span class="o">--</span><span class="n">role</span> <span class="n">Admin</span> \
      <span class="o">--</span><span class="n">password</span> <span class="n">admin</span> \
      <span class="o">--</span><span class="n">email</span> <span class="n">admin</span><span class="nd">@example</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
</div>
<div class="section" id="launch-airflow-server">
<h3><a class="toc-backref" href="#id8">Launch airflow server</a><a class="headerlink" href="#launch-airflow-server" title="Permalink to this headline">¶</a></h3>
<p>Set the base config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">afvenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">export</span> <span class="n">AIRFLOW_HOME</span><span class="o">=</span><span class="s2">&quot;$PWD/airflow_config&quot;</span>
<span class="n">export</span> <span class="n">AIRFLOW__CORE__LOAD_EXAMPLES</span><span class="o">=</span><span class="mi">0</span>
<span class="n">export</span> <span class="n">AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span><span class="o">=</span><span class="mi">0</span>
<span class="n">export</span> <span class="n">AIRFLOW__API__AUTH_BACKEND</span><span class="o">=</span><span class="n">airflow</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">basic_auth</span>
<span class="n">export</span> <span class="n">AIRFLOW__WEBSERVER__SECRET_KEY</span><span class="o">=</span><span class="n">e9adafa751fd35adfc1fdd3285019be15eea0758f76e38e1e37a1154fb36</span>
<span class="n">export</span> <span class="n">AIRFLOW_CONN_CF_URI</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">airflow_test</span><span class="nd">@admin</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">airflow_test_password</span><span class="nd">@localhost</span><span class="p">:</span><span class="mi">5000</span>
</pre></div>
</div>
<p>Start the web server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">airflow</span> <span class="n">webserver</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>Also, start the scheduler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">airflow</span> <span class="n">scheduler</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>airflow gui will be at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</div>
</div>
<div class="section" id="killing-airflow">
<h3><a class="toc-backref" href="#id9">Killing airflow</a><a class="headerlink" href="#killing-airflow" title="Permalink to this headline">¶</a></h3>
<p>Search for the code of the process in Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="n">aux</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">airflow</span>
</pre></div>
</div>
<p>Kill it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kill</span> <span class="o">-</span><span class="mi">9</span> <span class="n">CODE</span>
</pre></div>
</div>
<p>If you’re feeling lucky:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>kill -9 $(ps aux | grep &#39;airflow&#39; | awk &#39;{print $2}&#39;)
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-cornflow-with-the-python-client">
<h2><a class="toc-backref" href="#id10">Using cornflow with the python client</a><a class="headerlink" href="#using-cornflow-with-the-python-client" title="Permalink to this headline">¶</a></h2>
<p>Launch airflow (webserver and scheduler) and cornflow server (see sections above).</p>
<p>We’re going to test the cornflow server by using the <cite>cornflow-client</cite> and the <cite>pulp</cite> python package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">cornflow</span><span class="o">-</span><span class="n">client</span> <span class="n">pulp</span>
</pre></div>
</div>
<p>A complete example is shown in <cite>examples/basic_functions.py</cite>. Below is an extract.</p>
<p>Initialize the api client:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cornflow_client</span> <span class="kn">import</span> <span class="n">CornFlow</span>
<span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;some_email@gmail.com&#39;</span>
<span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;some_password&#39;</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;some_name&#39;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">CornFlow</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:5000&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="n">pwd</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">sign_up</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
<p>log in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
</pre></div>
</div>
<p>Prepare an instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pulp</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpProblem</span><span class="p">(</span><span class="s2">&quot;test_export_dict_MIP&quot;</span><span class="p">,</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpMinimize</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpInteger</span><span class="p">)</span>
<span class="n">prob</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">z</span><span class="p">,</span> <span class="s2">&quot;obj&quot;</span>
<span class="n">prob</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;c1&quot;</span>
<span class="n">prob</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">z</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;c2&quot;</span>
<span class="n">prob</span> <span class="o">+=</span> <span class="o">-</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">==</span> <span class="mf">7.5</span><span class="p">,</span> <span class="s2">&quot;c3&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">insName</span> <span class="o">=</span> <span class="s1">&#39;test_export_dict_MIP&#39;</span>
<span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;very small example&#39;</span>
</pre></div>
</div>
<p>Send instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">instance</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_instance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">insName</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
</pre></div>
</div>
<p>Solve an instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;PULP_CBC_CMD&quot;</span><span class="p">,</span>
    <span class="n">timeLimit</span> <span class="o">=</span> <span class="mi">10</span>
<span class="p">)</span>
<span class="n">execution</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_execution</span><span class="p">(</span>
    <span class="n">instance</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;execution1&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;execution of a very small instance&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Check the status of an execution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_solution</span><span class="p">(</span><span class="n">execution</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
<span class="c1"># 1 means &quot;finished correctly&quot;</span>
</pre></div>
</div>
<p>Retrieve a solution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_solution</span><span class="p">(</span><span class="n">execution</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="c1"># returns a json with the solved pulp object</span>
<span class="n">_vars</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpProblem</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Retrieve the log of the solver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_log</span><span class="p">(</span><span class="n">execution</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">])</span>
<span class="c1"># json format of the solver log</span>
</pre></div>
</div>
</div>
<div class="section" id="running-tests-and-coverage">
<h2><a class="toc-backref" href="#id11">Running tests and coverage</a><a class="headerlink" href="#running-tests-and-coverage" title="Permalink to this headline">¶</a></h2>
<p>Then you have to run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FLASK_ENV</span><span class="o">=</span><span class="n">testing</span>
</pre></div>
</div>
<p>Finally you can run all the tests with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">discover</span> <span class="o">-</span><span class="n">s</span> <span class="n">cornflow</span><span class="o">.</span><span class="n">tests</span>
</pre></div>
</div>
<p>If you want to only run the unit tests (without a local airflow webserver):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">discover</span> <span class="o">-</span><span class="n">s</span> <span class="n">cornflow</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
<p>If you want to only run the integration test with a local airflow webserver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">discover</span> <span class="o">-</span><span class="n">s</span> <span class="n">cornflow</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">integration</span>
</pre></div>
</div>
<p>After if you want to check the coverage report you need to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coverage</span> <span class="n">run</span>  <span class="o">--</span><span class="n">source</span><span class="o">=./</span><span class="n">cornflow</span><span class="o">/</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">discover</span> <span class="o">-</span><span class="n">s</span><span class="o">=./</span><span class="n">cornflow</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span>
<span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span>
</pre></div>
</div>
<p>or to get the html reports:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coverage</span> <span class="n">html</span>
</pre></div>
</div>
</div>
<div class="section" id="install-with-docker">
<h2><a class="toc-backref" href="#id12">Install with docker</a><a class="headerlink" href="#install-with-docker" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pull">
<h3><a class="toc-backref" href="#id13">Pull</a><a class="headerlink" href="#pull" title="Permalink to this headline">¶</a></h3>
<p>Pull the image from the Docker repository.</p>
<blockquote>
<div><p>docker pull baobabsoluciones/cornflow</p>
</div></blockquote>
</div>
<div class="section" id="build">
<h3><a class="toc-backref" href="#id14">Build</a><a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h3>
<p>Build cornflow image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">cornflow</span> <span class="o">.</span>
</pre></div>
</div>
<p>Optionally install Airflow personalized image in folder <cite>airflow_config</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">airflow_config</span> <span class="o">&amp;&amp;</span> <span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">docker</span><span class="o">-</span><span class="n">airflow</span> <span class="o">.</span>
</pre></div>
</div>
<p>Don’t forget to update the images in the docker-compose files to baobabsoluciones/cornflow:latest and baobabsoluciones/docker-airflow:latest.</p>
</div>
<div class="section" id="usage">
<h3><a class="toc-backref" href="#id15">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>We have created several <cite>docker-compose.yml</cite> files so that you can use them and deploy the test environment:
By default, docker-airflow runs Airflow with SequentialExecutor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">--</span><span class="n">build</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p>For CeleryExecutor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">cornflow</span><span class="o">-</span><span class="n">celery</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p>List containers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">ps</span>
</pre></div>
</div>
<p>Interact with container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker exec -it `docker ps -q --filter ancestor=baobabsoluciones/cornflow` bash
</pre></div>
</div>
<p>See the logs for a particular service (e.g., SERVICE=cornflow):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker-compose logs `docker ps -q --filter ancestor=baobabsoluciones/cornflow`
</pre></div>
</div>
<p>Stop the containers and clean volumes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">down</span> <span class="o">--</span><span class="n">volumes</span> <span class="o">--</span><span class="n">rmi</span> <span class="nb">all</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="help-me">
<h2><a class="toc-backref" href="#id16">Help me</a><a class="headerlink" href="#help-me" title="Permalink to this headline">¶</a></h2>
<p>If you have a database server and you only want to create the database or, for example, you already have an airflow environment, you can go to the following links to learn more about other types of cornflow deployment.</p>
<p><a class="reference external" href="https://baobabsoluciones.github.io/cornflow-server/main/includeme.html#install-cornflow">Cornflow complete install documentation</a></p>
<p><a class="reference external" href="https://baobabsoluciones.github.io/cornflow-server/deploy/index.html">Deploy cornflow with docker</a></p>
<p><a class="reference external" href="https://airflow.apache.org/docs/apache-airflow/2.1.0/index.html">Airflow documentation</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="concepts.html" class="btn btn-neutral float-right" title="Concepts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Main topics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-, cornflow documentation team..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>