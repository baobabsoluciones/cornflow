

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Installation instructions &mdash; Cornflow 3.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User guides and how-to" href="../guides/index.html" />
    <link rel="prev" title="Cornflow-server architecture" href="architecture.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Cornflow
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Main topics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Cornflow-server architecture</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installation instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-cornflow">Install cornflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-cornflow-database">Setup cornflow database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#launch-cornflow-server">Launch cornflow server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-and-configure-airflow">Install and configure airflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#launch-airflow-server">Launch airflow server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#killing-airflow">Killing airflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#install-with-docker">Install with docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pull">Pull</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build">Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#help-me">Help me</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">User guides and how-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples of solution methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clients/index.html">Supported clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/index.html">Deploy your own Cornflow-server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stable-rest-api-ref.html">API reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cornflow</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Main topics</a> &raquo;</li>
        
      <li>Installation instructions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/main/install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="installation-instructions">
<h1>Installation instructions<a class="headerlink" href="#installation-instructions" title="Permalink to this heading">¶</a></h1>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Linux or Windows with WSL</p></li>
<li><p>python &gt;= 3.7</p></li>
</ul>
</section>
<section id="install-cornflow">
<h2>Install cornflow<a class="headerlink" href="#install-cornflow" title="Permalink to this heading">¶</a></h2>
<p>Cornflow consists of two projects: cornflow (itself) and airflow (from apache). They are conceived to be deployed independently. Here we will explain the “development deploy” that consists on installing them in the same machine.</p>
<p>Download the Cornflow project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">baobabsoluciones</span><span class="o">/</span><span class="n">cornflow</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">cornflow</span><span class="o">-</span><span class="n">server</span>
<span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">venv</span>
<span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">pip3</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">-</span><span class="n">dev</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>activate the virtual environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>or, in windows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">venv</span><span class="o">/</span><span class="n">Scripts</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
</section>
<section id="setup-cornflow-database">
<h2>Setup cornflow database<a class="headerlink" href="#setup-cornflow-database" title="Permalink to this heading">¶</a></h2>
<p>This local example assumes sqlite as database engine. For an example of postgresql deployment, see the <a class="reference internal" href="../deploy/options.html#setup-cornflow-database-with-your-own-postgresql-server"><span class="std std-ref">this section</span></a>.</p>
<p>Initialize the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=</span><span class="n">cornflow</span><span class="o">.</span><span class="n">app</span>
<span class="n">export</span> <span class="n">DATABASE_URL</span><span class="o">=</span><span class="n">sqlite</span><span class="p">:</span><span class="o">///</span><span class="n">cornflow</span><span class="o">.</span><span class="n">db</span>
<span class="n">flask</span> <span class="n">db</span> <span class="n">upgrade</span>
<span class="n">flask</span> <span class="n">access_init</span> <span class="o">-</span><span class="n">v</span> <span class="mi">0</span>
<span class="n">flask</span> <span class="n">create_service_user</span>  <span class="o">-</span><span class="n">u</span> <span class="n">airflow</span> <span class="o">-</span><span class="n">e</span> <span class="n">airflow_test</span><span class="nd">@admin</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">p</span> <span class="n">airflow_test_password</span> <span class="o">-</span><span class="n">v</span> <span class="mi">0</span>
<span class="n">flask</span> <span class="n">create_admin_user</span>  <span class="o">-</span><span class="n">u</span> <span class="n">cornflow</span> <span class="o">-</span><span class="n">e</span> <span class="n">cornflow_admin</span><span class="nd">@admin</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">p</span> <span class="n">cornflow_admin_password</span> <span class="o">-</span><span class="n">v</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="launch-cornflow-server">
<h2>Launch cornflow server<a class="headerlink" href="#launch-cornflow-server" title="Permalink to this heading">¶</a></h2>
<p>Each time you run the flask server, execute the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=</span><span class="n">cornflow</span><span class="o">.</span><span class="n">app</span>
<span class="n">export</span> <span class="n">FLASK_ENV</span><span class="o">=</span><span class="n">development</span>
<span class="n">export</span> <span class="n">DATABASE_URL</span><span class="o">=</span><span class="n">sqlite</span><span class="p">:</span><span class="o">///</span><span class="n">cornflow</span><span class="o">.</span><span class="n">db</span>
<span class="n">export</span> <span class="n">SECRET_KEY</span><span class="o">=</span><span class="n">THISNEEDSTOBECHANGED</span>
<span class="n">export</span> <span class="n">AIRFLOW_URL</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span>
<span class="n">export</span> <span class="n">AIRFLOW_USER</span><span class="o">=</span><span class="n">admin</span>
<span class="n">export</span> <span class="n">AIRFLOW_PWD</span><span class="o">=</span><span class="n">admin</span>
<span class="n">flask</span> <span class="n">run</span>
</pre></div>
</div>
<p>In windows use <code class="docutils literal notranslate"><span class="pre">set</span></code> instead of <code class="docutils literal notranslate"><span class="pre">export</span></code>.</p>
</section>
<section id="install-and-configure-airflow">
<h2>Install and configure airflow<a class="headerlink" href="#install-and-configure-airflow" title="Permalink to this heading">¶</a></h2>
<p>Here are the minimal instructions to install and configure airflow with the default dags in this project. The instructions assume Ubuntu.</p>
<p>Create a virtual environment for airflow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">corn</span>
<span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">afvenv</span>
<span class="n">source</span> <span class="n">afvenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>Install airflow from pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AIRFLOW_VERSION</span><span class="o">=</span><span class="mf">2.1.0</span>
<span class="n">PYTHON_VERSION</span><span class="o">=</span><span class="s2">&quot;$(python3 --version | cut -d &quot;</span> <span class="s2">&quot; -f 2 | cut -d &quot;</span><span class="o">.</span><span class="s2">&quot; -f 1-2)&quot;</span>
<span class="n">CONSTRAINT_URL</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/apache/airflow/constraints-$</span><span class="si">{AIRFLOW_VERSION}</span><span class="s2">/constraints-$</span><span class="si">{PYTHON_VERSION}</span><span class="s2">.txt&quot;</span>
<span class="n">pip</span> <span class="n">install</span> <span class="s2">&quot;apache-airflow==$</span><span class="si">{AIRFLOW_VERSION}</span><span class="s2">&quot;</span> <span class="o">--</span><span class="n">constraint</span> <span class="s2">&quot;$</span><span class="si">{CONSTRAINT_URL}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Install the default workers dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">orloge</span> <span class="n">cornflow_client</span> <span class="n">pulp</span>
</pre></div>
</div>
<p>Initialize the database and create an admin user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">AIRFLOW_HOME</span><span class="o">=</span><span class="s2">&quot;$PWD/airflow_config&quot;</span>
<span class="n">airflow</span> <span class="n">db</span> <span class="n">init</span>
<span class="n">airflow</span> <span class="n">users</span> <span class="n">create</span> \
      <span class="o">--</span><span class="n">username</span> <span class="n">admin</span> \
      <span class="o">--</span><span class="n">firstname</span> <span class="n">admin</span> \
      <span class="o">--</span><span class="n">lastname</span> <span class="n">admin</span> \
      <span class="o">--</span><span class="n">role</span> <span class="n">Admin</span> \
      <span class="o">--</span><span class="n">password</span> <span class="n">admin</span> \
      <span class="o">--</span><span class="n">email</span> <span class="n">admin</span><span class="nd">@example</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
</section>
<section id="launch-airflow-server">
<h2>Launch airflow server<a class="headerlink" href="#launch-airflow-server" title="Permalink to this heading">¶</a></h2>
<p>Set the base config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">afvenv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">export</span> <span class="n">AIRFLOW_HOME</span><span class="o">=</span><span class="s2">&quot;$PWD/airflow_config&quot;</span>
<span class="n">export</span> <span class="n">AIRFLOW__CORE__LOAD_EXAMPLES</span><span class="o">=</span><span class="mi">0</span>
<span class="n">export</span> <span class="n">AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span><span class="o">=</span><span class="mi">0</span>
<span class="n">export</span> <span class="n">AIRFLOW__API__AUTH_BACKEND</span><span class="o">=</span><span class="n">airflow</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">basic_auth</span>
<span class="n">export</span> <span class="n">AIRFLOW__WEBSERVER__SECRET_KEY</span><span class="o">=</span><span class="n">e9adafa751fd35adfc1fdd3285019be15eea0758f76e38e1e37a1154fb36</span>
<span class="n">export</span> <span class="n">AIRFLOW_CONN_CF_URI</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">airflow_test</span><span class="nd">@admin</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">airflow_test_password</span><span class="nd">@localhost</span><span class="p">:</span><span class="mi">5000</span>
</pre></div>
</div>
<p>Start the web server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">airflow</span> <span class="n">webserver</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>Also, start the scheduler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">airflow</span> <span class="n">scheduler</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>airflow gui will be at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</div>
</section>
<section id="killing-airflow">
<h2>Killing airflow<a class="headerlink" href="#killing-airflow" title="Permalink to this heading">¶</a></h2>
<p>Search for the code of the process in Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="n">aux</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">airflow</span>
</pre></div>
</div>
<p>Kill it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kill</span> <span class="o">-</span><span class="mi">9</span> <span class="n">CODE</span>
</pre></div>
</div>
<p>If you’re feeling lucky:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>kill -9 $(ps aux | grep &#39;airflow&#39; | awk &#39;{print $2}&#39;)
</pre></div>
</div>
</section>
</section>
<section id="install-with-docker">
<h1>Install with docker<a class="headerlink" href="#install-with-docker" title="Permalink to this heading">¶</a></h1>
<section id="pull">
<h2>Pull<a class="headerlink" href="#pull" title="Permalink to this heading">¶</a></h2>
<p>Pull the image from the Docker repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">baobabsoluciones</span><span class="o">/</span><span class="n">cornflow</span>
</pre></div>
</div>
</section>
<section id="build">
<h2>Build<a class="headerlink" href="#build" title="Permalink to this heading">¶</a></h2>
<p>Build cornflow image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">cornflow</span> <span class="o">.</span>
</pre></div>
</div>
<p>Optionally install Airflow personalized image in folder <cite>airflow_config</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">airflow_config</span> <span class="o">&amp;&amp;</span> <span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">docker</span><span class="o">-</span><span class="n">airflow</span> <span class="o">.</span>
</pre></div>
</div>
<p>Don’t forget to update the images in the docker-compose files to baobabsoluciones/cornflow:latest and baobabsoluciones/docker-airflow:latest.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p>We have created several <cite>docker-compose.yml</cite> files so that you can use them and deploy the test environment:
By default, docker-airflow runs Airflow with SequentialExecutor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">--</span><span class="n">build</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p>For CeleryExecutor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">cornflow</span><span class="o">-</span><span class="n">celery</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p>List containers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">ps</span>
</pre></div>
</div>
<p>Interact with container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker exec -it `docker ps -q --filter ancestor=baobabsoluciones/cornflow` bash
</pre></div>
</div>
<p>See the logs for a particular service (e.g., SERVICE=cornflow):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker-compose logs `docker ps -q --filter ancestor=baobabsoluciones/cornflow`
</pre></div>
</div>
<p>Stop the containers and clean volumes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">down</span> <span class="o">--</span><span class="n">volumes</span> <span class="o">--</span><span class="n">rmi</span> <span class="nb">all</span>
</pre></div>
</div>
<section id="help-me">
<h3>Help me<a class="headerlink" href="#help-me" title="Permalink to this heading">¶</a></h3>
<p>If you have a database server and you only want to create the database or, for example, you already have an airflow environment, you can go to the following links to learn more about other types of cornflow deployment.</p>
<p><a class="reference internal" href="../deploy/index.html#deploy-your-own-cornflow-server"><span class="std std-ref">Deploy cornflow with docker</span></a></p>
<p><a class="reference external" href="https://airflow.apache.org/docs/apache-airflow/2.1.0/index.html">Airflow documentation</a></p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../guides/index.html" class="btn btn-neutral float-right" title="User guides and how-to" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="architecture.html" class="btn btn-neutral float-left" title="Cornflow-server architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-, cornflow documentation team..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>